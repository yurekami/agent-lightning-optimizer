# Mutator File Structure

Complete list of all files in the mutation engine.

## Configuration Files

### `package.json`
- Project metadata and dependencies
- Scripts: build, dev, start, typecheck
- Dependencies: @anthropic-ai/sdk, postgres, zod, uuid

### `tsconfig.json`
- TypeScript compiler configuration
- Target: ES2022
- Strict mode enabled
- Output: dist/ directory

### `.env.example`
- Environment variable template
- Database URL
- Anthropic API key
- Service configuration
- Model selection
- Validation thresholds

### `.gitignore`
- Excludes: node_modules, dist, .env, logs

### `.dockerignore`
- Docker build exclusions

## Documentation

### `README.md`
- Overview and features
- Installation instructions
- Configuration guide
- Usage examples
- API documentation
- Development guide

### `ARCHITECTURE.md`
- System architecture
- Component breakdown
- Mutation flow diagrams
- Model selection strategy
- Error handling patterns
- Performance characteristics
- Extension points

### `QUICKSTART.md`
- 5-minute setup guide
- Manual testing steps
- Docker deployment
- Common issues
- Monitoring queries

### `FILES.md` (this file)
- Complete file listing
- File purposes

## Docker Files

### `Dockerfile`
- Multi-stage build
- Node.js 20 Alpine base
- Production optimization
- Non-root user
- Health check

## Source Code

### Core Service

#### `src/index.ts`
- Main entry point
- Configuration loader
- Main mutation loop
- Polls for candidates
- Graceful shutdown
- Batch processing

#### `src/service.ts`
- MutationService class
- `applyMutation()` - Apply specific mutation
- `applyRandomMutation()` - Apply weighted random
- `generateVariants()` - Generate N variants
- Retry logic with exponential backoff
- Validation integration

#### `src/db.ts`
- Database class
- PostgreSQL operations via postgres.js
- `getPromptVersion()` - Fetch version
- `getCandidatesForTesting()` - Find candidates
- `createPromptVersion()` - Save mutated version
- `logMutationAttempt()` - Log attempts
- Connection pooling

### Type Definitions

#### `src/types.ts`
- TypeScript interfaces and types
- `PromptContent` - Prompt structure
- `PromptVersion` - Database model
- `MutationType` - Mutation enum
- `MutationConfig` - Mutation metadata
- `MutationContext` - Runtime context
- `MutationResult` - Result type
- `ValidationResult` - Validation output
- `MutatorConfig` - Service config

### Mutations

#### `src/mutations/index.ts`
- Central mutation registry
- 11 mutation configurations
- Weight assignments
- Complexity levels
- `getAllMutationTypes()` - Get all types
- `getMutation()` - Get config
- `selectRandomMutation()` - Weighted selection
- `selectModelForMutation()` - Model routing

#### `src/mutations/rephrase.ts`
- `rephraseForClarity()` - Improve clarity
- Claude API integration
- Response parsing

#### `src/mutations/examples.ts`
- `addExamples()` - Add concrete examples
- `removeExamples()` - Remove examples
- Higher temperature for creativity

#### `src/mutations/verbosity.ts`
- `increaseVerbosity()` - Add detail
- `decreaseVerbosity()` - Make concise
- Verbosity control

#### `src/mutations/structure.ts`
- `restructureSections()` - Reorganize
- `addEdgeCases()` - Add edge cases
- `addConstraints()` - Add constraints
- `simplifyInstructions()` - Simplify
- Structural transformations

#### `src/mutations/tone.ts`
- `changeToneFormal()` - Make formal
- `changeToneCasual()` - Make casual
- Tone adjustments

### Supporting Modules

#### `src/prompts.ts`
- Meta-prompt templates
- `MUTATION_PROMPTS` - Prompt registry
- `formatMutationPrompt()` - Template formatter
- Instructs Claude how to mutate

#### `src/validation.ts`
- `validateMutation()` - Validate result
- Length checks
- Semantic similarity
- Structure validation
- Keyword preservation
- `validatePromptContent()` - Type guard
- `extractKeywords()` - Keyword extraction
- `calculateSimpleSimilarity()` - Similarity metric

## Build Output (dist/)

Generated by TypeScript compiler:

### JavaScript Files
- `dist/index.js` - Compiled main
- `dist/service.js` - Compiled service
- `dist/db.js` - Compiled database
- `dist/types.js` - Compiled types
- `dist/prompts.js` - Compiled prompts
- `dist/validation.js` - Compiled validation
- `dist/mutations/index.js` - Compiled registry
- `dist/mutations/rephrase.js`
- `dist/mutations/examples.js`
- `dist/mutations/verbosity.js`
- `dist/mutations/structure.js`
- `dist/mutations/tone.js`

### Type Declarations
- `dist/*.d.ts` - TypeScript declarations
- `dist/mutations/*.d.ts` - Mutation declarations

### Source Maps
- `dist/*.js.map` - Source maps for debugging
- `dist/*.d.ts.map` - Declaration maps

## File Count Summary

- **Source files**: 11 TypeScript files
- **Configuration**: 5 files
- **Documentation**: 4 Markdown files
- **Docker**: 2 files
- **Generated**: 28 build artifacts
- **Total**: ~50 files

## File Dependencies

```
index.ts
├── service.ts
│   ├── db.ts
│   ├── types.ts
│   ├── mutations/index.ts
│   │   ├── mutations/rephrase.ts
│   │   ├── mutations/examples.ts
│   │   ├── mutations/verbosity.ts
│   │   ├── mutations/structure.ts
│   │   └── mutations/tone.ts
│   └── validation.ts
├── prompts.ts
└── types.ts
```

## External Dependencies

### Production
- `@anthropic-ai/sdk` - Claude API client
- `postgres` - PostgreSQL client
- `zod` - Schema validation
- `uuid` - UUID generation
- `dotenv` - Environment variables

### Development
- `typescript` - TypeScript compiler
- `tsx` - TypeScript execution
- `@types/node` - Node.js types
- `@types/uuid` - UUID types

## Size Statistics

- **Total source code**: ~1,500 lines
- **Generated code**: ~1,000 lines
- **Documentation**: ~2,000 lines
- **Package size**: ~10 MB (with node_modules)
- **Docker image**: ~200 MB

## Key Files for Customization

### Adding New Mutations
1. Create `src/mutations/newMutation.ts`
2. Update `src/mutations/index.ts`
3. Add template to `src/prompts.ts`

### Changing Validation
1. Edit `src/validation.ts`
2. Adjust thresholds in `.env`

### Database Schema
1. Edit `src/db.ts` for queries
2. Update `src/types.ts` for types

### Service Behavior
1. Edit `src/index.ts` for main loop
2. Edit `src/service.ts` for mutation logic

## Critical Files (Don't Delete!)

- ✅ `src/index.ts` - Entry point
- ✅ `src/service.ts` - Core logic
- ✅ `src/db.ts` - Database access
- ✅ `src/mutations/index.ts` - Mutation registry
- ✅ `package.json` - Dependencies
- ✅ `tsconfig.json` - Build config
- ✅ `.env` - Runtime config (create from .env.example)

## Optional Files

- ⚪ `README.md` - Can be regenerated
- ⚪ `ARCHITECTURE.md` - Reference documentation
- ⚪ `QUICKSTART.md` - Getting started guide
- ⚪ `FILES.md` - This file
